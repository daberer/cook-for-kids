{% load static %}
{% load bootstrap5 %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Month</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    

    <style>
        /* Your custom button styles */
        body {
            padding-left: 1.5em;
        }

        .btn {
            display: inline-block;
            padding: 5px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        /* Give each form-group some vertical spacing */
        .form-group {
            margin-bottom: 1rem;
            /* Adjust as needed */
        }


        #id_dates,
        #id_dish,
        #id_dishes_this_month {
            width: 1200px;
            /* Adjust to your preference (e.g. 400px) */
        }

        .form-group input {
            line-height: 2em;
            font-size: large;
        }
        .form-group select {
            font-size: large;
        }

        .cooking-info {
            margin: 15px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }

        .cooking-info.warning {
            border-left-color: #dc3545;
            background-color: #fff8f8;
        }
    </style>
</head>

<body>
    <!-- Container for any Django messages -->
    <div class="container mt-4">
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div id="id_long_desc" class="container">
        <h2 class="header">Setup Month</h2>

        <!-- Cooking services information -->
        {% if cooking_data %}
        <div class="cooking-info {% if cooking_data.kochdienste < cooking_data.kochtage %}warning{% endif %}">
            <h5>Cooking Services Status:</h5>
            <p>This month requires <strong>{{ cooking_data.kochtage }}</strong> cooking services.</p>
            <p>Currently <strong>{{ cooking_data.kochdienste }}</strong> cooking services are available.</p>
            {% if cooking_data.kochdienste < cooking_data.kochtage %}
            <p class="text-danger"><strong>Warning:</strong> Not enough cooking services available for this month!</p>
            {% elif cooking_data.kochdienste > cooking_data.kochtage %}
            <p class="text-success">Extra cooking services available this month.</p>
            {% else %}
            <p class="text-success">Perfect match! Cooking services match exactly what's needed.</p>
            {% endif %}
        </div>
        {% endif %}

        <form action="" method="post">
            {% csrf_token %}
            <div class="form-group">
                {{ form.year }}
            </div>
            <div class="form-group">
                {{ form.month }}
            </div>
            <div class="form-group">
                {{ form.kid }}
            </div>
            <div class="form-group">
                {{ form.dates }}
            </div>
            <div class="form-group">
                {{ form.dish }}
            </div>
            <div class="form-group">
                {{ form.dishes_this_month }}
            </div>
            <div class="form-group">
                {{ form.wishdays }}
                check when dates input are the only days possible
            </div>
            <div class="form-group">
                <input class="btn btn-primary" type="submit" value="Submit">
            </div>
        </form>
    </div>

    <div class="container mt-3">
        <button class="btn btn-primary" onclick="location.href='/'">Home</button>
    </div>

    <!-- Simple vanilla JavaScript to update form fields -->
    <script>
        // Kid data for each kid (will be populated by Django)
        var kidData = {
            {% for kid in form.kid.field.queryset %}
                {{ kid.id }}: {
                    "dish": "{{ kid.dish_set.last.dish_name|default:'' }}",
                    "monthly_dishes": {{ kid.monthly_dishes|default:0 }}
                },
            {% endfor %}
        };

        // Get form elements
        var kidSelect = document.getElementById('id_kid');
        var dishInput = document.getElementById('id_dish');
        var dishesThisMonthInput = document.getElementById('id_dishes_this_month');

        // Add event listener to kid select
        if (kidSelect) {
            kidSelect.addEventListener('change', function() {
                updateKidInfo();
            });
        } else {
            console.error("Kid select element not found!");
        }

        // Function to update form fields
        function updateKidInfo() {
            var selectedKidId = kidSelect.value;

            if (selectedKidId && kidData[selectedKidId]) {
                dishInput.value = kidData[selectedKidId].dish || '';
                dishesThisMonthInput.value = kidData[selectedKidId].monthly_dishes || '';
            } else {
                dishInput.value = '';
                dishesThisMonthInput.value = '';
            }
        }
    </script>
</body>
</html>
